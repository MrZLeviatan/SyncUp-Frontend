<div class="perfil-container">
  <div class="perfil-card rediseño-card-horizontal">
    <!-- FOTO DE PERFIL IZQUIERDA -->
    <div class="perfil-foto-lateral">
      <img
        *ngIf="usuario?.fotoPerfilUrl; else defaultFoto"
        [src]="usuario!.fotoPerfilUrl"
        alt="Foto de perfil"
      />
      <ng-template #defaultFoto>
        <i class="fa fa-user-circle"></i>
      </ng-template>
    </div>

    <!-- INFO Y FORMULARIOS DERECHA -->
    <div class="perfil-info-form">
      <!-- INFORMACIÓN DEL USUARIO -->
      <!-- INFORMACIÓN DEL USUARIO -->
      <div class="info-usuario-red">
        <h2>
          {{ usuario?.nombre || usuario?.username }}
          <!-- Contador de seguidos -->
          <span class="contador-seguidos" *ngIf="cantidadSeguidos !== null">
            (Seguidos: {{ cantidadSeguidos }})
          </span>
        </h2>
        <p><strong>Username:</strong> {{ usuario?.username }}</p>
      </div>

      <!-- ACCIONES -->
      <div class="acciones-red">
        <button
          class="btn-accion-red"
          (click)="mostrarEditarNombre = !mostrarEditarNombre; mostrarEditarPassword = false"
        >
          <i class="fa fa-edit"></i> Actualizar Perfil
        </button>
        <button
          class="btn-accion-red rojo"
          (click)="mostrarEditarPassword = !mostrarEditarPassword; mostrarEditarNombre = false"
        >
          <i class="fa fa-lock"></i> Cambiar Contraseña
        </button>
      </div>

      <!-- FORMULARIOS -->
      <div class="formularios-red">
        <!-- FORM ACTUALIZAR NOMBRE -->
        <div *ngIf="mostrarEditarNombre" class="formulario-red">
          <h3>Actualizar Nombre</h3>
          <div class="labels-nombre">
            <input type="text" [(ngModel)]="nombreActualizado" placeholder="Nuevo nombre" />
          </div>
          <button class="btn-guardar-red" (click)="actualizarNombre()">
            <i class="fa fa-save"></i> Guardar
          </button>
        </div>

        <!-- FORM ACTUALIZAR PASSWORD -->
        <div *ngIf="mostrarEditarPassword" class="formulario-red">
          <h3>Cambiar Contraseña</h3>
          <div class="labels-nombre">
            <input type="password" [(ngModel)]="passwordAnterior" placeholder="Contraseña actual" />
            <input type="password" [(ngModel)]="nuevoPassword" placeholder="Nueva contraseña" />
          </div>
          <button class="btn-guardar-red rojo" (click)="actualizarPassword()">
            <i class="fa fa-key"></i> Actualizar
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="perfil-favoritas">
    <!-- Título centrado -->
    <h3 class="subtitulo-favoritas">Mis Canciones Favoritas</h3>

    <!-- Botón de descarga encima -->
    <!-- Botón de descarga encima -->
    <div class="favoritas-botones-superior">
      <button class="btn-accion-csv" (click)="descargarCancionesCSV()">
        <i class="fa fa-download"></i> Descargar CSV
      </button>
    </div>

    <!-- Layout principal de la lista -->
    <div class="favoritas-layout">
      <!-- Lista de canciones -->
      <app-lista-canciones
        [canciones]="cancionesFavoritas"
        [alturaLista]="300"
        (cancionSeleccionada)="onSeleccionarCancion($event)"
        class="lista-canciones"
      ></app-lista-canciones>

      <!-- Información de la canción seleccionada -->
      <div class="cancion-info" *ngIf="cancionSeleccionada">
        <h4>Información de la Canción</h4>
        <p><strong>Título:</strong> {{ cancionSeleccionada.titulo }}</p>
        <p><strong>Artista:</strong> {{ artistaSeleccionado?.nombreArtistico || 'Cargando...' }}</p>
        <p><strong>Duración:</strong> {{ cancionSeleccionada.duracion }} min</p>

        <div class="botones-cancion">
          <!-- Botón rojo para quitar favorita -->
          <button class="btn-accion-red rojo" (click)="quitarCancionFavorita()">
            <i class="fa fa-trash"></i> Quitar de Favoritas
          </button>
          <!-- Botón de aceptación para cancelar -->
          <button class="btn-guardar-red" (click)="cancionSeleccionada = null">
            <i class="fa fa-times"></i> Cancelar
          </button>
        </div>
      </div>
    </div>
    <!-- SECCIÓN AMIGOS Y SUGERENCIAS -->
    <div class="perfil-amigos">
      <!-- MIS AMIGOS -->
      <div class="seccion-amigos">
        <h3 class="subtitulo-favoritas">Mis Amigos</h3>

        <div class="amigos-layout">
          <app-lista-usuarios
            [alturaLista]="300"
            [usuarios]="misAmigos"
            (usuarioSeleccionado)="onSeleccionarAmigo($event)"
          ></app-lista-usuarios>

          <div class="usuario-info" *ngIf="usuarioAmigoSeleccionado">
            <h4>Información del Amigo</h4>
            <p><strong>Username:</strong> {{ usuarioAmigoSeleccionado.username }}</p>
            <p><strong>Nombre:</strong> {{ usuarioAmigoSeleccionado.nombre }}</p>

            <div class="botones-cancion">
              <button class="btn-accion-red rojo" (click)="confirmarDejarSeguir()">
                <i class="fa fa-user-times"></i> Dejar de Seguir
              </button>
              <button class="btn-guardar-red" (click)="cancelarSeleccionAmigo()">
                <i class="fa fa-times"></i> Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- SUGERENCIAS DE AMIGOS -->
      <div class="seccion-amigos">
        <h3 class="subtitulo-favoritas">Sugerencias de Amigos</h3>

        <div class="amigos-layout">
          <app-lista-usuarios
            [alturaLista]="300"
            [usuarios]="sugerenciasAmigos"
            (usuarioSeleccionado)="onSeleccionarSugerencia($event)"
          ></app-lista-usuarios>

          <div class="usuario-info" *ngIf="usuarioSugerenciaSeleccionado">
            <h4>Información del Usuario</h4>
            <p><strong>Username:</strong> {{ usuarioSugerenciaSeleccionado.username }}</p>
            <p><strong>Nombre:</strong> {{ usuarioSugerenciaSeleccionado.nombre }}</p>

            <div class="botones-cancion">
              <button class="btn-accion-red" (click)="confirmarSeguir()">
                <i class="fa fa-user-plus"></i> Seguir
              </button>
              <button class="btn-guardar-red rojo" (click)="cancelarSeleccionSugerencia()">
                <i class="fa fa-times"></i> Cancelar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
